<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loan Amortization Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=Manrope:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:15px;scroll-behavior:smooth}
body{font-family:'Manrope',system-ui,sans-serif;background:#0c0f14;color:#e6edf3;line-height:1.65;min-height:100vh;-webkit-font-smoothing:antialiased}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.09);border-radius:3px}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useRef,useEffect,useCallback} = React;

/* ‚ïê‚ïê‚ïê NUMBER TO INDIAN WORDS ‚ïê‚ïê‚ïê */
function numberToWords(num) {
  if (!num || isNaN(num) || num <= 0) return '';
  num = Math.round(num);
  const ones = ['','One','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Eleven','Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen'];
  const tens = ['','','Twenty','Thirty','Forty','Fifty','Sixty','Seventy','Eighty','Ninety'];
  if (num < 20) return ones[num];
  if (num < 100) return tens[Math.floor(num/10)] + (num%10 ? ' ' + ones[num%10] : '');
  if (num < 1000) return ones[Math.floor(num/100)] + ' Hundred' + (num%100 ? ' and ' + numberToWords(num%100) : '');
  if (num < 100000) return numberToWords(Math.floor(num/1000)) + ' Thousand' + (num%1000 ? ' ' + numberToWords(num%1000) : '');
  if (num < 10000000) return numberToWords(Math.floor(num/100000)) + ' Lakh' + (num%100000 ? ' ' + numberToWords(num%100000) : '');
  return numberToWords(Math.floor(num/10000000)) + ' Crore' + (num%10000000 ? ' ' + numberToWords(num%10000000) : '');
}
function amountInWords(num, sym) {
  if (!num || isNaN(num) || num <= 0) return '';
  const w = numberToWords(Math.round(num));
  // Also show short form
  let short = '';
  if (num >= 10000000) short = ' (' + (num/10000000).toFixed(2) + ' Cr)';
  else if (num >= 100000) short = ' (' + (num/100000).toFixed(2) + ' Lakhs)';
  return sym + ' ' + w + short;
}

/* ‚ïê‚ïê‚ïê FINANCIAL ENGINE ‚ïê‚ïê‚ïê */
function addMonths(date,months){const d=new Date(date);const day=d.getDate();d.setMonth(d.getMonth()+months);if(d.getDate()!==day)d.setDate(0);return d}
function daysBetween(a,b){return Math.round((b-a)/864e5)}
function fmtDate(d){return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')}
function computeEMI(P,r,n){if(r===0)return P/n;if(n<=0)return 0;const f=Math.pow(1+r,n);return P*r*f/(f-1)}
function computePeriodInterest(pr,ar,comp,dc,ps,pe){const rate=ar/100;if(comp==='monthly')return dc==='30_360'?pr*(rate/12):pr*rate*daysBetween(ps,pe)/365;const days=daysBetween(ps,pe);return dc==='30_360'?pr*(rate/360)*30:pr*(rate/365)*days}
function periodicRate(ar,comp,dc){const r=ar/100;if(comp==='monthly')return r/12;return dc==='30_360'?r/360*30:r/12}
function applyRounding(v,m){return m==='nearest_rupee'?Math.round(v):Math.round(v*100)/100}
function fmtCurrency(v,sym,m){const n=m==='nearest_rupee'?Math.round(v):Math.round(v*100)/100;return sym+n.toLocaleString('en-IN',{minimumFractionDigits:m==='exact'?2:0,maximumFractionDigits:m==='exact'?2:0})}
function fmtLakhs(v,s){if(Math.abs(v)>=1e7)return s+(v/1e7).toFixed(2)+' Cr';if(Math.abs(v)>=1e5)return s+(v/1e5).toFixed(2)+' L';return s+Math.round(v).toLocaleString('en-IN')}
function computeBaselineInterest(pr,ar,tm,pm,co,dc,rn){const tp=Math.ceil(tm/pm);let r=periodicRate(ar,co,dc);if(pm===3&&co==='monthly')r=Math.pow(1+periodicRate(ar,'monthly',dc),3)-1;const emi=applyRounding(computeEMI(pr,r,tp),rn);let bal=pr,tot=0;for(let i=0;i<tp&&bal>0.5;i++){const int=bal*r;let pc=emi-int;if(i===tp-1||pc>=bal)pc=bal;bal-=pc;if(bal<0)bal=0;tot+=int}return tot}

/**
 * Get the applicable interest rate for a given date from rate change timeline.
 * rateChanges: [{date: Date, rate: number}] sorted by date
 * initialRate: starting annual rate
 */
function getRateForDate(date, initialRate, rateChanges) {
  let currentRate = initialRate;
  for (const rc of rateChanges) {
    if (date >= rc.date) currentRate = rc.rate;
    else break;
  }
  return currentRate;
}

function generateSchedule(cfg){
  const pm=cfg.emiFrequency==='quarterly'?3:1,totalPeriods=Math.ceil(cfg.tenureMonths/pm);
  const schedule=[];let outstanding=cfg.principal,currentRate=cfg.annualRate;
  let remaining=totalPeriods,currentEMI=0,totalInt=0,totalPP=0;
  const morPeriods=Math.ceil(cfg.moratoriumMonths/pm);

  // Sort rate changes
  const rateChanges = (cfg.rateChanges || []).slice().sort((a,b) => a.date - b.date);

  // Moratorium
  for(let m=0;m<morPeriods&&outstanding>0;m++){
    const ps=addMonths(cfg.emiStartDate,m*pm),pe=addMonths(cfg.emiStartDate,(m+1)*pm);
    currentRate = getRateForDate(ps, cfg.annualRate, rateChanges);
    let interest=0;
    if(cfg.emiFrequency==='quarterly'&&cfg.compounding==='monthly'){let tp=outstanding;for(let sm=0;sm<3;sm++){const si=computePeriodInterest(tp,currentRate,cfg.compounding,cfg.dayCount,addMonths(ps,sm),addMonths(ps,sm+1));interest+=si;if(cfg.moratoriumType==='interest_capitalized')tp+=si}}
    else interest=computePeriodInterest(outstanding,currentRate,cfg.compounding,cfg.dayCount,ps,pe);
    const op=outstanding;
    if(cfg.moratoriumType==='interest_only'){const ri=applyRounding(interest,cfg.rounding);schedule.push({period:m+1,date:pe,opening:op,emi:ri,interest:ri,principalComp:0,prepayment:0,closing:outstanding,isMoratorium:true,isPrepay:false,rate:currentRate});totalInt+=ri}
    else{outstanding+=interest;schedule.push({period:m+1,date:pe,opening:op,emi:0,interest,principalComp:0,prepayment:0,closing:outstanding,isMoratorium:true,isPrepay:false,rate:currentRate})}
  }

  remaining=totalPeriods-morPeriods;
  let r=periodicRate(currentRate,cfg.compounding,cfg.dayCount);
  if(cfg.emiFrequency==='quarterly'&&cfg.compounding==='monthly')r=Math.pow(1+periodicRate(currentRate,'monthly',cfg.dayCount),3)-1;
  currentEMI=applyRounding(computeEMI(outstanding,r,remaining),cfg.rounding);
  const baseInt=computeBaselineInterest(cfg.principal,cfg.annualRate,cfg.tenureMonths,pm,cfg.compounding,cfg.dayCount,cfg.rounding);

  // Prepayment map
  const ppMap={};cfg.prepayments.forEach(pp=>{const k=fmtDate(pp.date).slice(0,7);ppMap[k]=(ppMap[k]||0)+pp.amount});

  let pidx=morPeriods,prevRate=currentRate;
  while(outstanding>0.5&&remaining>0){
    pidx++;
    const ps=addMonths(cfg.emiStartDate,(pidx-1)*pm),pe=addMonths(cfg.emiStartDate,pidx*pm),pk=fmtDate(ps).slice(0,7);

    // Check for rate change
    const newRate = getRateForDate(ps, cfg.annualRate, rateChanges);
    if (newRate !== prevRate) {
      currentRate = newRate;
      prevRate = currentRate;
      r = periodicRate(currentRate, cfg.compounding, cfg.dayCount);
      if(cfg.emiFrequency==='quarterly'&&cfg.compounding==='monthly') r=Math.pow(1+periodicRate(currentRate,'monthly',cfg.dayCount),3)-1;
      // Recalculate EMI with new rate and remaining periods
      currentEMI = applyRounding(computeEMI(outstanding, r, remaining), cfg.rounding);
    }

    // Prepayments
    let ppAmt=0;if(ppMap[pk])ppAmt+=ppMap[pk];if(cfg.recurringExtra>0)ppAmt+=cfg.recurringExtra;
    if(ppAmt>=outstanding){schedule.push({period:pidx,date:pe,opening:outstanding,emi:0,interest:0,principalComp:0,prepayment:applyRounding(outstanding,cfg.rounding),closing:0,isMoratorium:false,isPrepay:true,rate:currentRate});totalPP+=outstanding;outstanding=0;break}
    outstanding-=ppAmt;totalPP+=ppAmt;

    // Reduce EMI after prepayment if chosen
    if(ppAmt>0&&cfg.prepayImpact==='reduce_emi'){
      r=periodicRate(currentRate,cfg.compounding,cfg.dayCount);
      if(cfg.emiFrequency==='quarterly'&&cfg.compounding==='monthly')r=Math.pow(1+periodicRate(currentRate,'monthly',cfg.dayCount),3)-1;
      currentEMI=applyRounding(computeEMI(outstanding,r,remaining),cfg.rounding);
    }

    const openP=outstanding;let int2=0;
    if(cfg.emiFrequency==='quarterly'&&cfg.compounding==='monthly'){for(let sm=0;sm<3;sm++)int2+=computePeriodInterest(outstanding,currentRate,'monthly',cfg.dayCount,addMonths(ps,sm),addMonths(ps,sm+1))}
    else int2=computePeriodInterest(outstanding,currentRate,cfg.compounding,cfg.dayCount,ps,pe);
    let emi=currentEMI,pc=emi-int2;
    if(remaining===1||pc>=outstanding){pc=outstanding;emi=applyRounding(pc+int2,cfg.rounding)}
    if(pc<0)pc=0;outstanding-=pc;if(outstanding<0.005)outstanding=0;totalInt+=int2;
    schedule.push({period:pidx,date:pe,opening:openP,emi:applyRounding(emi,cfg.rounding),interest:int2,principalComp:pc,prepayment:applyRounding(ppAmt,cfg.rounding),closing:outstanding,isMoratorium:false,isPrepay:ppAmt>0,rate:currentRate});
    remaining--;
  }
  let totalPaid=0;schedule.forEach(row=>{totalPaid+=row.emi+row.prepayment});
  return{schedule,summary:{totalInterestPaid:totalInt,totalAmountPaid:totalPaid,interestSaved:Math.max(0,baseInt-totalInt),effectiveTenure:schedule.length,totalPrepayments:totalPP,emi:currentEMI,originalTenure:totalPeriods}};
}

/* ‚ïê‚ïê‚ïê HELP TOOLTIP ‚ïê‚ïê‚ïê */
function HelpTip({text}){
  const[open,setOpen]=useState(false);const ref=useRef(null);
  useEffect(()=>{if(!open)return;const h=e=>{if(ref.current&&!ref.current.contains(e.target))setOpen(false)};document.addEventListener('click',h,true);return()=>document.removeEventListener('click',h,true)},[open]);
  return React.createElement('span',{ref,style:{position:'relative',display:'inline-flex'}},
    React.createElement('button',{onClick:e=>{e.stopPropagation();setOpen(!open)},style:{width:16,height:16,borderRadius:'50%',border:'1px solid '+(open?'#4f8ff7':'rgba(255,255,255,0.1)'),background:open?'rgba(79,143,247,0.15)':'rgba(255,255,255,0.04)',color:open?'#4f8ff7':'#545d68',fontSize:9,fontWeight:700,cursor:'pointer',display:'inline-flex',alignItems:'center',justifyContent:'center',fontFamily:'monospace',transition:'all 0.15s',flexShrink:0}},'?'),
    open&&React.createElement('div',{style:{position:'absolute',top:'calc(100% + 8px)',left:'50%',transform:'translateX(-50%)',width:260,background:'#252d3f',border:'1px solid rgba(255,255,255,0.1)',borderRadius:8,padding:'10px 12px',fontSize:13,color:'#8b949e',lineHeight:1.6,boxShadow:'0 8px 32px rgba(0,0,0,0.5)',zIndex:100}},React.createElement('div',{dangerouslySetInnerHTML:{__html:text}}))
  );
}

function Field({label,help,hint,error,children}){
  return React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:4}},
    React.createElement('div',{style:{display:'flex',alignItems:'center',gap:6}},
      React.createElement('label',{style:{fontSize:11,fontWeight:600,textTransform:'uppercase',letterSpacing:'0.06em',color:'#8b949e',fontFamily:"'JetBrains Mono',monospace"}},label),
      help&&React.createElement(HelpTip,{text:help})
    ),
    children,
    hint&&React.createElement('span',{style:{fontSize:11,color:'#545d68',fontStyle:'italic'}},hint),
    error&&React.createElement('span',{style:{fontSize:11,color:'#e5534b',fontWeight:500}},error)
  );
}

const IS={fontFamily:"'Manrope',system-ui,sans-serif",fontSize:14,padding:'9px 12px',background:'#0e1219',border:'1px solid rgba(255,255,255,0.06)',borderRadius:6,color:'#e6edf3',width:'100%',outline:'none',transition:'all 0.15s'};
const IE={...IS,borderColor:'#e5534b',boxShadow:'0 0 0 3px rgba(229,83,75,0.1)'};
const SS={...IS,cursor:'pointer'};
const CS={background:'#171c27',border:'1px solid rgba(255,255,255,0.06)',borderRadius:14,padding:'20px 24px',marginBottom:16};
const CT={fontFamily:"'JetBrains Mono',monospace",fontSize:10.5,fontWeight:600,textTransform:'uppercase',letterSpacing:'0.1em',color:'#4f8ff7',marginBottom:16,paddingBottom:10,borderBottom:'1px solid rgba(255,255,255,0.06)'};
const MS={fontFamily:"'JetBrains Mono',monospace",fontSize:10.5,fontWeight:500,letterSpacing:'0.04em'};
const G2={display:'grid',gridTemplateColumns:'1fr 1fr',gap:16};
const G3={display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:16};
const RBTN={width:30,height:30,borderRadius:6,border:'1px solid rgba(255,255,255,0.06)',background:'#0e1219',color:'#8b949e',cursor:'pointer',fontSize:14,display:'flex',alignItems:'center',justifyContent:'center'};
const ABTN={...MS,color:'#4f8ff7',background:'rgba(79,143,247,0.1)',border:'1px dashed rgba(79,143,247,0.3)',borderRadius:6,padding:'7px 14px',cursor:'pointer',marginTop:12};

/* ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê */
function App(){
  const[principal,setPrincipal]=useState('5000000');
  const[rate,setRate]=useState('8.5');
  const[tenure,setTenure]=useState('240');
  const[startDate,setStartDate]=useState('2025-04-01');
  // Simple prepayment: one part payment
  const[ppDate,setPpDate]=useState('');
  const[ppAmount,setPpAmount]=useState('');
  const[ppImpact,setPpImpact]=useState('reduce_tenure');
  // Extra prepayments (power user)
  const[morePPs,setMorePPs]=useState([]);
  const[extraEmi,setExtraEmi]=useState('0');
  // Rate change timeline
  const[rateChanges,setRateChanges]=useState([]);
  // Advanced
  const[showAdv,setShowAdv]=useState(false);
  const[compounding,setCompounding]=useState('monthly');
  const[dayCount,setDayCount]=useState('30_360');
  const[frequency,setFrequency]=useState('monthly');
  const[rounding,setRounding]=useState('nearest_rupee');
  const[currency,setCurrency]=useState('‚Çπ');
  const[granularity,setGranularity]=useState('monthly');
  const[morMonths,setMorMonths]=useState('0');
  const[morType,setMorType]=useState('interest_only');
  const[errors,setErrors]=useState({});
  const[result,setResult]=useState(null);
  const[loading,setLoading]=useState(false);
  const[activeTab,setActiveTab]=useState('monthly');
  const resultRef=useRef(null);

  const validate=useCallback(()=>{
    const e={};
    if(!parseFloat(principal)||parseFloat(principal)<1000)e.principal='Min 1,000';
    if(!parseFloat(rate)||parseFloat(rate)<0.01||parseFloat(rate)>50)e.rate='0.01‚Äì50%';
    if(!parseInt(tenure)||parseInt(tenure)<1||parseInt(tenure)>600)e.tenure='1‚Äì600';
    if(!startDate||isNaN(new Date(startDate+'T00:00:00').getTime()))e.startDate='Invalid';
    setErrors(e);return Object.keys(e).length===0;
  },[principal,rate,tenure,startDate]);

  const calculate=()=>{
    if(!validate())return;setLoading(true);
    setTimeout(()=>{
      try{
        // Build prepayments list from simple + extra
        const allPPs = [];
        if (ppDate && parseFloat(ppAmount) > 0) allPPs.push({date:new Date(ppDate+'T00:00:00'),amount:parseFloat(ppAmount)});
        morePPs.forEach(p => { if(p.date && p.amount > 0) allPPs.push({date:new Date(p.date+'T00:00:00'),amount:p.amount}) });
        // Build rate changes
        const allRC = rateChanges.filter(rc => rc.date && rc.rate > 0).map(rc => ({date:new Date(rc.date+'T00:00:00'),rate:rc.rate}));

        const cfg={principal:parseFloat(principal),annualRate:parseFloat(rate),tenureMonths:parseInt(tenure),emiStartDate:new Date(startDate+'T00:00:00'),compounding,dayCount,emiFrequency:frequency,moratoriumMonths:parseInt(morMonths)||0,moratoriumType:morType,interestType:'fixed',resetFreq:6,benchmarkRate:0,spread:0,prepayments:allPPs,recurringExtra:parseFloat(extraEmi)||0,prepayImpact:ppImpact,rounding,currency:currency||'‚Çπ',rateChanges:allRC};
        const res=generateSchedule(cfg);setResult({...res,cfg});setActiveTab('monthly');
        setTimeout(()=>resultRef.current?.scrollIntoView({behavior:'smooth',block:'start'}),100);
      }catch(err){console.error(err)}
      setLoading(false);
    },80);
  };

  const exportCSV=()=>{
    if(!result)return;const{cfg}=result,fc=v=>fmtCurrency(v,cfg.currency,cfg.rounding);
    const h='"#","Date","Rate%","Opening","EMI","Interest","Principal","Prepayment","Closing"';
    const rows=result.schedule.map(r=>`"${r.period}","${fmtDate(r.date)}","${r.rate}","${fc(r.opening)}","${fc(r.emi)}","${fc(r.interest)}","${fc(r.principalComp)}","${r.prepayment>0?fc(r.prepayment):''}","${fc(r.closing)}"`);
    const blob=new Blob([h+'\n'+rows.join('\n')],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='amortization.csv';a.click();
  };

  // Amount in words for principal
  const principalWords = amountInWords(parseFloat(principal), currency || '‚Çπ');
  const ppAmountWords = amountInWords(parseFloat(ppAmount), currency || '‚Çπ');

  return React.createElement('div',{style:{fontFamily:"'Manrope',system-ui,sans-serif",background:'#0c0f14',color:'#e6edf3',minHeight:'100vh'}},

    /* HERO */
    React.createElement('div',{style:{textAlign:'center',padding:'40px 24px 28px',borderBottom:'1px solid rgba(255,255,255,0.06)',background:'radial-gradient(ellipse 60% 50% at 50% 0%,rgba(79,143,247,0.07) 0%,transparent 70%)'}},
      React.createElement('h1',{style:{fontFamily:"'Fraunces',Georgia,serif",fontSize:32,fontWeight:600,letterSpacing:'-0.02em'}},'Loan Amortization Engine'),
      React.createElement('p',{style:{color:'#8b949e',marginTop:8,fontSize:15,maxWidth:520,marginLeft:'auto',marginRight:'auto'}},'See where every rupee goes ‚Äî EMI breakdown, prepayment savings, and the true cost of borrowing.'),
      React.createElement('div',{style:{display:'flex',gap:20,justifyContent:'center',marginTop:14,flexWrap:'wrap'}},
        ['Reducing-Balance','Bank-Grade Accuracy','100% Client-Side'].map(t=>
          React.createElement('span',{key:t,style:{...MS,color:'#545d68',display:'flex',alignItems:'center',gap:5}},
            React.createElement('span',{style:{width:5,height:5,borderRadius:'50%',background:'#3fb950',boxShadow:'0 0 6px rgba(63,185,80,0.4)'}}),t)))
    ),

    React.createElement('div',{style:{maxWidth:720,margin:'0 auto',padding:'28px 20px 60px'}},

      /* ‚ïê‚ïê‚ïê CORE INPUTS ‚ïê‚ïê‚ïê */
      React.createElement('div',{style:{...CS,borderColor:Object.keys(errors).length?'#e5534b':undefined}},
        React.createElement('div',{style:CT},'Loan Details'),
        React.createElement('div',{style:G2},
          React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:4}},
            React.createElement('div',{style:{display:'flex',alignItems:'center',gap:6}},
              React.createElement('label',{style:{fontSize:11,fontWeight:600,textTransform:'uppercase',letterSpacing:'0.06em',color:'#8b949e',fontFamily:"'JetBrains Mono',monospace"}},'Principal Amount'),
              React.createElement(HelpTip,{text:'The total loan amount you\'re borrowing, before any interest.'})
            ),
            React.createElement('input',{style:errors.principal?IE:IS,type:'number',value:principal,onChange:e=>{setPrincipal(e.target.value);setErrors({})}}),
            principalWords && React.createElement('span',{style:{fontSize:11,color:'#3fb950',fontWeight:500,lineHeight:1.4}},principalWords),
            React.createElement('span',{style:{fontSize:11,color:'#545d68',fontStyle:'italic'}},'e.g. 5000000 = ‚Çπ50 Lakhs'),
            errors.principal&&React.createElement('span',{style:{fontSize:11,color:'#e5534b',fontWeight:500}},errors.principal)
          ),
          React.createElement(Field,{label:'Annual Rate (%)',help:'Yearly interest rate. This is your starting rate ‚Äî add rate changes below if it changes over time.',hint:'Most home loans: 8‚Äì10%',error:errors.rate},
            React.createElement('input',{style:errors.rate?IE:IS,type:'number',value:rate,onChange:e=>{setRate(e.target.value);setErrors({})},step:'0.01'})
          ),
          React.createElement(Field,{label:'Tenure (Months)',help:'Total repayment period. 120=10yr, 240=20yr, 360=30yr.',hint:'240 = 20 years',error:errors.tenure},
            React.createElement('input',{style:errors.tenure?IE:IS,type:'number',value:tenure,onChange:e=>{setTenure(e.target.value);setErrors({})}})
          ),
          React.createElement(Field,{label:'EMI Start Date',help:'Date of your first EMI payment.',error:errors.startDate},
            React.createElement('input',{style:errors.startDate?IE:IS,type:'date',value:startDate,onChange:e=>{setStartDate(e.target.value);setErrors({})}})
          )
        )
      ),

      /* ‚ïê‚ïê‚ïê RATE CHANGES (the real-world repo rate scenario) ‚ïê‚ïê‚ïê */
      React.createElement('div',{style:CS},
        React.createElement('div',{style:CT},'Interest Rate Changes ',React.createElement('span',{style:{fontWeight:400,textTransform:'none',letterSpacing:0,color:'#545d68'}},'‚Äî if your rate changed over time')),
        React.createElement('p',{style:{fontSize:13,color:'#545d68',marginBottom:12,lineHeight:1.6}},'Did your bank change your interest rate after a repo rate revision? Add each change below. If your rate hasn\'t changed, skip this.'),
        rateChanges.map((rc,i)=>
          React.createElement('div',{key:i,style:{display:'flex',gap:8,alignItems:'center',marginBottom:8}},
            React.createElement('input',{style:{...IS,flex:1},type:'date',value:rc.date,placeholder:'Date',onChange:e=>{const n=[...rateChanges];n[i]={...n[i],date:e.target.value};setRateChanges(n)}}),
            React.createElement('input',{style:{...IS,flex:1},type:'number',value:rc.rate,placeholder:'New rate %',step:'0.01',onChange:e=>{const n=[...rateChanges];n[i]={...n[i],rate:parseFloat(e.target.value)||''};setRateChanges(n)}}),
            React.createElement('button',{onClick:()=>setRateChanges(rateChanges.filter((_,idx)=>idx!==i)),style:RBTN},'‚úï')
          )
        ),
        React.createElement('button',{onClick:()=>setRateChanges([...rateChanges,{date:'',rate:''}]),style:ABTN},'+ Add Rate Change'),
        rateChanges.length===0&&React.createElement('span',{style:{fontSize:11,color:'#545d68',marginLeft:12}},'e.g. "2026-01-15 ‚Üí 8.1%" after a repo cut')
      ),

      /* ‚ïê‚ïê‚ïê PART PAYMENT (simple ‚Äî one field) ‚ïê‚ïê‚ïê */
      React.createElement('div',{style:CS},
        React.createElement('div',{style:CT},'Part Payment ',React.createElement('span',{style:{fontWeight:400,textTransform:'none',letterSpacing:0,color:'#545d68'}},'‚Äî optional')),
        React.createElement('p',{style:{fontSize:13,color:'#545d68',marginBottom:12,lineHeight:1.6}},'Planning to make a lump-sum payment? Enter the date and amount.'),
        React.createElement('div',{style:G2},
          React.createElement(Field,{label:'Payment Date'},
            React.createElement('input',{style:IS,type:'date',value:ppDate,onChange:e=>setPpDate(e.target.value)})
          ),
          React.createElement('div',{style:{display:'flex',flexDirection:'column',gap:4}},
            React.createElement('label',{style:{fontSize:11,fontWeight:600,textTransform:'uppercase',letterSpacing:'0.06em',color:'#8b949e',fontFamily:"'JetBrains Mono',monospace"}},'Amount'),
            React.createElement('input',{style:IS,type:'number',value:ppAmount,onChange:e=>setPpAmount(e.target.value)}),
            ppAmountWords && React.createElement('span',{style:{fontSize:11,color:'#3fb950',fontWeight:500,lineHeight:1.4}},ppAmountWords)
          )
        ),
        React.createElement('div',{style:{marginTop:12}},
          React.createElement(Field,{label:'After part payment',help:'<strong>Reduce Tenure:</strong> Same EMI, finish earlier ‚Äî saves more interest.<br/><br/><strong>Reduce EMI:</strong> Lower monthly payment, same duration.'},
            React.createElement('select',{style:{...SS,maxWidth:320},value:ppImpact,onChange:e=>setPpImpact(e.target.value)},
              React.createElement('option',{value:'reduce_tenure'},'Reduce Tenure (saves more interest)'),
              React.createElement('option',{value:'reduce_emi'},'Reduce EMI (lower monthly payment)')
            )
          )
        ),
        /* Additional prepayments */
        morePPs.length > 0 && React.createElement('div',{style:{marginTop:16,paddingTop:12,borderTop:'1px solid rgba(255,255,255,0.06)'}},
          React.createElement('label',{style:{fontSize:11,fontWeight:600,textTransform:'uppercase',letterSpacing:'0.06em',color:'#8b949e',fontFamily:"'JetBrains Mono',monospace",marginBottom:8,display:'block'}},'Additional Part Payments'),
          morePPs.map((pp,i)=>
            React.createElement('div',{key:i,style:{display:'flex',gap:8,alignItems:'center',marginBottom:8}},
              React.createElement('input',{style:{...IS,flex:1},type:'date',value:pp.date,onChange:e=>{const n=[...morePPs];n[i]={...n[i],date:e.target.value};setMorePPs(n)}}),
              React.createElement('input',{style:{...IS,flex:1},type:'number',value:pp.amount,placeholder:'Amount',onChange:e=>{const n=[...morePPs];n[i]={...n[i],amount:parseFloat(e.target.value)||''};setMorePPs(n)}}),
              React.createElement('button',{onClick:()=>setMorePPs(morePPs.filter((_,idx)=>idx!==i)),style:RBTN},'‚úï')
            )
          )
        ),
        React.createElement('div',{style:{marginTop:8,display:'flex',gap:12,alignItems:'center'}},
          React.createElement('button',{onClick:()=>setMorePPs([...morePPs,{date:'',amount:''}]),style:ABTN},'+ Add Another Part Payment'),
          React.createElement(Field,{label:'',help:'Add multiple part payments if you plan to pay extra at different times.'},null)
        )
      ),

      /* ‚ïê‚ïê‚ïê ADVANCED OPTIONS ‚ïê‚ïê‚ïê */
      React.createElement('button',{onClick:()=>setShowAdv(!showAdv),style:{display:'flex',alignItems:'center',gap:8,cursor:'pointer',padding:'14px 0',color:'#545d68',fontSize:14,fontWeight:500,border:'none',background:'none',fontFamily:"'Manrope',sans-serif"}},
        React.createElement('span',{style:{...MS,transition:'transform 0.2s',transform:showAdv?'rotate(180deg)':'none'}},'‚ñæ'),
        'Advanced Options',
        React.createElement('span',{style:{fontSize:11.5,color:'#3d4550'}},'‚Äî recurring extra EMI, moratorium, conventions')
      ),

      showAdv&&React.createElement('div',null,
        React.createElement('div',{style:CS},
          React.createElement('div',{style:CT},'Recurring Extra Payment'),
          React.createElement(Field,{label:'Extra Amount Every Month',help:'A fixed additional amount on top of EMI every month. Even ‚Çπ5,000/mo saves lakhs over the loan life.',hint:'0 = none'},
            React.createElement('input',{style:IS,type:'number',value:extraEmi,onChange:e=>setExtraEmi(e.target.value)})
          )
        ),
        React.createElement('div',{style:CS},
          React.createElement('div',{style:CT},'Moratorium'),
          React.createElement('div',{style:G2},
            React.createElement(Field,{label:'Period (Months)',help:'Grace period at start. Common in construction/education loans. 0=none.',hint:'0 = none'},
              React.createElement('input',{style:IS,type:'number',value:morMonths,onChange:e=>setMorMonths(e.target.value)})
            ),
            React.createElement(Field,{label:'Type',help:'<strong>Interest Only:</strong> Pay interest; principal unchanged.<br/><br/><strong>Capitalized:</strong> No payment; interest adds to principal.'},
              React.createElement('select',{style:SS,value:morType,onChange:e=>setMorType(e.target.value)},
                React.createElement('option',{value:'interest_only'},'Interest Only'),
                React.createElement('option',{value:'interest_capitalized'},'Interest Capitalized')
              )
            )
          )
        ),
        React.createElement('div',{style:CS},
          React.createElement('div',{style:CT},'Conventions'),
          React.createElement('div',{style:G3},
            React.createElement(Field,{label:'Compounding'},React.createElement('select',{style:SS,value:compounding,onChange:e=>setCompounding(e.target.value)},React.createElement('option',{value:'monthly'},'Monthly'),React.createElement('option',{value:'daily'},'Daily'))),
            React.createElement(Field,{label:'Day Count'},React.createElement('select',{style:SS,value:dayCount,onChange:e=>setDayCount(e.target.value)},React.createElement('option',{value:'30_360'},'30/360'),React.createElement('option',{value:'actual_365'},'Actual/365'))),
            React.createElement(Field,{label:'Frequency'},React.createElement('select',{style:SS,value:frequency,onChange:e=>setFrequency(e.target.value)},React.createElement('option',{value:'monthly'},'Monthly'),React.createElement('option',{value:'quarterly'},'Quarterly')))
          ),
          React.createElement('div',{style:{...G3,marginTop:16}},
            React.createElement(Field,{label:'Rounding'},React.createElement('select',{style:SS,value:rounding,onChange:e=>setRounding(e.target.value)},React.createElement('option',{value:'nearest_rupee'},'Nearest ‚Çπ'),React.createElement('option',{value:'exact'},'Exact'))),
            React.createElement(Field,{label:'Currency'},React.createElement('input',{style:IS,value:currency,onChange:e=>setCurrency(e.target.value),maxLength:5})),
            React.createElement(Field,{label:'Schedule'},React.createElement('select',{style:SS,value:granularity,onChange:e=>setGranularity(e.target.value)},React.createElement('option',{value:'monthly'},'Monthly'),React.createElement('option',{value:'yearly'},'Yearly'),React.createElement('option',{value:'both'},'Both')))
          )
        )
      ),

      /* ‚ïê‚ïê‚ïê ACTIONS ‚ïê‚ïê‚ïê */
      React.createElement('div',{style:{display:'flex',gap:10,margin:'20px 0 32px',flexWrap:'wrap'}},
        React.createElement('button',{onClick:calculate,disabled:loading,style:{fontFamily:"'Manrope',sans-serif",fontSize:14,fontWeight:600,padding:'12px 28px',borderRadius:10,border:'none',cursor:loading?'not-allowed':'pointer',background:'#4f8ff7',color:'#fff',opacity:loading?0.5:1,boxShadow:'0 2px 16px rgba(79,143,247,0.25)',transition:'all 0.15s',display:'flex',alignItems:'center',gap:8}},
          loading&&React.createElement('span',{style:{width:14,height:14,border:'2px solid rgba(255,255,255,0.3)',borderTopColor:'#fff',borderRadius:'50%',animation:'spin 0.6s linear infinite',display:'inline-block'}}),
          'Generate Schedule'
        ),
        React.createElement('button',{onClick:()=>{setPrincipal('5000000');setRate('8.5');setTenure('240');setStartDate('2025-04-01');setPpDate('');setPpAmount('');setMorePPs([]);setRateChanges([]);setExtraEmi('0');setMorMonths('0');setResult(null);setErrors({})},style:{fontFamily:"'Manrope',sans-serif",fontSize:14,fontWeight:600,padding:'12px 24px',borderRadius:10,border:'1px solid rgba(255,255,255,0.09)',background:'transparent',color:'#8b949e',cursor:'pointer'}},'Reset')
      ),

      /* ‚ïê‚ïê‚ïê OUTPUT ‚ïê‚ïê‚ïê */
      result&&React.createElement('div',{ref:resultRef},
        React.createElement('hr',{style:{border:'none',borderTop:'1px solid rgba(255,255,255,0.06)',margin:'32px 0'}}),
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'baseline',marginBottom:8,flexWrap:'wrap'}},
          React.createElement('h2',{style:{fontFamily:"'Fraunces',Georgia,serif",fontSize:22,fontWeight:600}},'Your Loan Breakdown'),
          React.createElement('button',{onClick:exportCSV,style:{...MS,color:'#8b949e',background:'#171c27',border:'1px solid rgba(255,255,255,0.06)',padding:'6px 12px',borderRadius:6,cursor:'pointer'}},'‚§ì CSV')
        ),
        /* Insights */
        React.createElement('div',{style:{background:'linear-gradient(135deg,#171c27 0%,#161c2a 100%)',border:'1px solid rgba(255,255,255,0.06)',borderRadius:14,padding:20,marginBottom:16}},
          React.createElement('h3',{style:{fontFamily:"'Fraunces',serif",fontSize:15,fontWeight:600,marginBottom:8}},'üí° Key Insights'),
          React.createElement('div',{style:{fontSize:14,color:'#8b949e',lineHeight:1.85},dangerouslySetInnerHTML:{__html:(()=>{
            const{cfg,summary:s}=result,fc=v=>fmtCurrency(v,cfg.currency,cfg.rounding),fl=v=>fmtLakhs(v,cfg.currency),freq=cfg.emiFrequency==='quarterly'?'quarter':'month';
            let h='Your <strong style="color:#e6edf3">EMI is '+fc(s.emi)+'</strong> per '+freq+'. Over the loan\'s life, you\'ll pay <strong style="color:#d29922">'+fl(s.totalInterestPaid)+'</strong> in interest ‚Äî <strong style="color:#e6edf3">'+(s.totalInterestPaid/cfg.principal*100).toFixed(1)+'%</strong> of principal.';
            if(s.totalPrepayments>0){h+='<br/><br/>Part payments of <strong style="color:#e6edf3">'+fc(s.totalPrepayments)+'</strong>';if(s.interestSaved>0)h+=' save <strong style="color:#3fb950">'+fl(s.interestSaved)+'</strong> in interest';const saved=s.originalTenure-s.effectiveTenure;if(saved>0&&cfg.prepayImpact==='reduce_tenure')h+=' and shorten the loan by <strong style="color:#3fb950">'+saved+' months</strong>';h+='.'}
            if(cfg.rateChanges&&cfg.rateChanges.length>0)h+='<br/><br/><strong style="color:#e6edf3">'+cfg.rateChanges.length+' rate change'+(cfg.rateChanges.length>1?'s':'')+' applied</strong> ‚Äî EMI was recalculated at each change.';
            if(cfg.moratoriumMonths>0)h+='<br/><br/>During the <strong style="color:#e6edf3">'+cfg.moratoriumMonths+'-month moratorium</strong>, '+(cfg.moratoriumType==='interest_capitalized'?'unpaid interest was added to principal.':'you paid interest-only.');
            return h;
          })()}})
        ),
        /* Summary Cards */
        React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(140px,1fr))',gap:10,marginBottom:16}},
          [{l:'Monthly EMI',v:fmtCurrency(result.summary.emi,result.cfg.currency,result.cfg.rounding),a:'blue'},{l:'Total Paid',v:fmtLakhs(result.summary.totalAmountPaid,result.cfg.currency)},{l:'Total Interest',v:fmtLakhs(result.summary.totalInterestPaid,result.cfg.currency),a:'amber'},{l:'Interest Saved',v:fmtLakhs(result.summary.interestSaved,result.cfg.currency),a:'green'},{l:'Tenure',v:result.summary.effectiveTenure+' mo'}].map(c=>
            React.createElement('div',{key:c.l,style:{background:'#171c27',border:'1px solid rgba(255,255,255,0.06)',borderRadius:10,padding:'14px 12px',textAlign:'center',borderLeft:c.a?'3px solid '+{blue:'#4f8ff7',amber:'#d29922',green:'#3fb950'}[c.a]:undefined}},
              React.createElement('div',{style:{...MS,fontSize:9,textTransform:'uppercase',letterSpacing:'0.1em',color:'#545d68',marginBottom:5}},c.l),
              React.createElement('div',{style:{fontFamily:"'Fraunces',serif",fontSize:19,fontWeight:600,color:c.a?{blue:'#4f8ff7',amber:'#d29922',green:'#3fb950'}[c.a]:'#e6edf3'}},c.v)
            ))
        ),
        /* Breakdown Bar */
        (()=>{const pP=(result.cfg.principal/result.summary.totalAmountPaid*100).toFixed(1),iP=(result.summary.totalInterestPaid/result.summary.totalAmountPaid*100).toFixed(1);
          return React.createElement('div',{style:{marginBottom:20}},
            React.createElement('div',{style:{display:'flex',height:12,borderRadius:6,overflow:'hidden',background:'#0e1219'}},React.createElement('div',{style:{width:pP+'%',background:'#4f8ff7',borderRadius:'6px 0 0 6px'}}),React.createElement('div',{style:{width:iP+'%',background:'#d29922'}})),
            React.createElement('div',{style:{display:'flex',gap:20,marginTop:8}},[['#4f8ff7','Principal '+pP+'%'],['#d29922','Interest '+iP+'%']].map(([c,l])=>React.createElement('span',{key:l,style:{...MS,fontSize:10,color:'#545d68',display:'flex',alignItems:'center',gap:5}},React.createElement('span',{style:{width:7,height:7,borderRadius:2,background:c}}),l))))})(),
        /* Disclaimer */
        React.createElement('div',{style:{fontSize:11,color:'#545d68',padding:'10px 14px',background:'rgba(210,153,34,0.08)',border:'1px solid rgba(210,153,34,0.12)',borderRadius:6,marginBottom:16,lineHeight:1.6}},React.createElement('strong',{style:{color:'#d29922'}},'Disclaimer:'),' Estimation tool. Actual bank schedules may vary. Verify with your lender.'),
        /* Table */
        (()=>{
          const tabs=[];const g=granularity;
          if(g==='monthly'||g==='both')tabs.push('monthly');if(g==='yearly'||g==='both')tabs.push('yearly');if(!tabs.length)tabs.push('monthly');
          const fc=v=>fmtCurrency(v,result.cfg.currency,result.cfg.rounding);
          const TH={fontFamily:"'JetBrains Mono',monospace",fontSize:9.5,fontWeight:600,textTransform:'uppercase',letterSpacing:'0.08em',color:'#545d68',padding:'10px 10px',textAlign:'right',borderBottom:'1px solid rgba(255,255,255,0.09)',background:'#12161e',position:'sticky',top:0,zIndex:2,whiteSpace:'nowrap'};
          const TD={padding:'7px 10px',textAlign:'right',borderBottom:'1px solid rgba(255,255,255,0.03)',fontFamily:"'JetBrains Mono',monospace",fontSize:11.5,color:'#8b949e',whiteSpace:'nowrap'};
          const yearlyData={};result.schedule.forEach(r=>{const y=r.date.getFullYear();if(!yearlyData[y])yearlyData[y]={year:y,interest:0,principal:0,prepayment:0,emi:0,closing:0};yearlyData[y].interest+=r.interest;yearlyData[y].principal+=r.principalComp;yearlyData[y].prepayment+=r.prepayment;yearlyData[y].emi+=r.emi;yearlyData[y].closing=r.closing});
          return React.createElement('div',null,
            React.createElement('div',{style:{display:'flex',borderBottom:'1px solid rgba(255,255,255,0.06)',marginBottom:12}},tabs.map(t=>React.createElement('button',{key:t,onClick:()=>setActiveTab(t),style:{...MS,fontSize:10.5,textTransform:'uppercase',padding:'10px 18px',background:'transparent',color:activeTab===t?'#4f8ff7':'#545d68',border:'none',borderBottom:'2px solid '+(activeTab===t?'#4f8ff7':'transparent'),cursor:'pointer'}},t==='monthly'?'Monthly':'Yearly'))),
            React.createElement('div',{style:{overflow:'auto',border:'1px solid rgba(255,255,255,0.06)',borderRadius:10,background:'#171c27',maxHeight:480}},
              activeTab==='monthly'?
                React.createElement('table',{style:{width:'100%',borderCollapse:'collapse'}},
                  React.createElement('thead',null,React.createElement('tr',null,
                    React.createElement('th',{style:{...TH,textAlign:'center',width:40}},'#'),
                    React.createElement('th',{style:{...TH,textAlign:'left'}},'Date'),
                    React.createElement('th',{style:TH},'Rate'),
                    ['Opening','EMI','Interest','Principal','Prepay','Closing'].map(h=>React.createElement('th',{key:h,style:TH},h))
                  )),
                  React.createElement('tbody',null,result.schedule.map(row=>
                    React.createElement('tr',{key:row.period,style:{background:row.isMoratorium?'rgba(210,153,34,0.05)':row.isPrepay?'rgba(63,185,80,0.05)':undefined}},
                      React.createElement('td',{style:{...TD,textAlign:'center',color:'#545d68',fontSize:10.5}},row.period),
                      React.createElement('td',{style:{...TD,textAlign:'left',fontSize:11}},fmtDate(row.date),row.isMoratorium&&React.createElement('span',{style:{fontSize:9,color:'#d29922',fontWeight:600}},' M')),
                      React.createElement('td',{style:{...TD,fontSize:10.5}},row.rate+'%'),
                      React.createElement('td',{style:TD},fc(row.opening)),React.createElement('td',{style:TD},fc(row.emi)),
                      React.createElement('td',{style:TD},fc(row.interest)),React.createElement('td',{style:TD},fc(row.principalComp)),
                      React.createElement('td',{style:{...TD,color:row.prepayment>0?'#3fb950':undefined,fontWeight:row.prepayment>0?600:undefined}},row.prepayment>0?fc(row.prepayment):'‚Äî'),
                      React.createElement('td',{style:TD},fc(row.closing))
                    )
                  ))
                ):
                React.createElement('table',{style:{width:'100%',borderCollapse:'collapse'}},
                  React.createElement('thead',null,React.createElement('tr',null,React.createElement('th',{style:{...TH,textAlign:'center'}},'Year'),['EMI','Interest','Principal','Prepay','Closing'].map(h=>React.createElement('th',{key:h,style:TH},h)))),
                  React.createElement('tbody',null,Object.values(yearlyData).map(row=>
                    React.createElement('tr',{key:row.year},React.createElement('td',{style:{...TD,textAlign:'center'}},row.year),React.createElement('td',{style:TD},fc(row.emi)),React.createElement('td',{style:TD},fc(row.interest)),React.createElement('td',{style:TD},fc(row.principal)),React.createElement('td',{style:TD},row.prepayment>0?fc(row.prepayment):'‚Äî'),React.createElement('td',{style:TD},fc(row.closing)))
                  ))
                )
            ))})()
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
